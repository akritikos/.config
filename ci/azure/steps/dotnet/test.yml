parameters:
- name: configuration
  type: string
  default: $(BuildConfiguration)
- name: coverageDirectory
  type: string
  default: $(build.artifactStagingDirectory)/coverage/

steps:
- task: DotNetCoreCLI@2
  displayName: Test Solution
  inputs:
    command: 'test'
    configuration: ${{ parameters.configuration }}
    publishTestResults: true
    testRunTitle: 'Discover and run tests'
    # Multiple comma seperated msbuild parameters should be seperated with %2c
    # Additionally, VSTS does not need escaped quotes
    arguments: '--logger trx --no-restore --verbosity normal /p:CollectCoverage=true /p:CoverletOutputFormat="opencover%2ccobertura" /p:CoverletOutput=${{ parameters.coverageDirectory }} /p:MergeWith=${{ parameters.coverageDirectory }}/coverage.json'
    verbosityPack: Minimal
    verbosityRestore: Minimal
